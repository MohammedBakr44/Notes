We perform `static analysis` on malware samples to extract info such as:
- File type
- File hash
- Strings
- Embedded elements/resources
- Packer information
- Imports
- Exports
- Assembly code

![](https://i.imgur.com/F6dsrwF.png)

## Identifying file type

This can be done using the `file` command or a hex editor like `hexdump` on Linux

```
file <target>
```

```
hexdump -C <targat>
```

![](https://i.imgur.com/iXsvj3f.png)

We can deduce the file type from `hexdump`, e.g: in this example the file starts with `MZ` which is a unique trait of `PE`(Portable Executable) files on Windows.

### Malware Fingerprinting

We use hashes like `md5` and `SHA256` to identify files, it works as a digital fingerprint for malware(other files as well), we can use this hash to share the malware with other researchers or search for that specific malware.

```
md5sum <target>
```

```
sha256sum <target>
```

### File Hash Lookup

Copy the hash to [VirusTotal](https://www.virustotal.com/gui/home/search).

#### Import Hashing (IMPHASH)

Calculate hash using imported libraries.

We can generate it using Python

```python
import sys
import pefile
import peutils

pe_file = sys.argv[1]
pe = pefile.PE(pe_file)
imphash = pe.get_imphash()

print(imphash)
```


#### Fuzzy Hashing (SSDEEP)

Deep hashing, divides the file into many blocks; helpful in identifying minor modifications.

```
ssdeep <target>
```

```
ssdeep -pb <targets>

potato.exe matches svchost.exe (99)

svchost.exe matches potato.exe (99)
```

to initiate difference mode; the previous snipped returned **99%** similarity between the two files.

#### Section Hashing

Hash each PE section separately, it can be useful for identifying minor variations in malware samples.

It works by calculating the cryptographic hash of each of all sections.

```python
import sys
import pefile
pe_file = sys.argv[1]
pe = pefile.PE(pe_file)
for section in pe.sections:
    print (section.Name, "MD5 hash:", section.get_hash_md5())
    print (section.Name, "SHA256 hash:", section.get_hash_sha256())
```

>Remember that while `section hashing` is a powerful technique, it is not foolproof. Malware authors might employ tactics like section name obfuscation or dynamically generating section names to try and bypass this kind of analysis.

### String Analysis

We use strings to find clues in sample strings' such as:

- Embedded filenames (e.g., dropped files)
- IP addresses or domain names
- Registry paths or keys
- Windows API functions
- Command-line arguments
- Unique information that might hint at a particular threat actor

We can use `strings` command or `FLOSS`, `FLOSS` works better at detecting and decoding stack and obfuscated strings.

### Unpacking UPX-packed malware

Malware authors use packing to achieve:

- Obfuscation.
- Reduced size binary.
- Anti-Analysis.


#### Identifying packers

We can identify packers using strings, or section names as many packers change section names.

We can also observe sections and compare virtual size against raw size, or we can use a tool like `DEI`(Detect It Easy).

